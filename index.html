<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMG Revolver</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: black;
            color: white;
            margin: 0;
            text-align: center;
        }
        canvas {
            display: block;
            margin: 20px auto;
            background-color: #111;
            border: 2px solid white;
        }
        .menu, .game-over, .game {
            display: none;
        }
        .menu button, .menu input {
            margin: 10px;
            padding: 10px;
            font-size: 18px;
        }
        .leaderboard {
            background: #222;
            margin: 20px auto;
            padding: 10px;
            border-radius: 10px;
            width: 300px;
            color: white;
        }
        .leaderboard .rank {
            font-size: 16px;
            margin: 5px 0;
        }
        .gold { color: gold; }
        .silver { color: silver; }
        .bronze { color: #cd7f32; }
    </style>
</head>
<body>
    <h1>DMG Revolver</h1>

    <!-- Hauptmenü -->
    <div class="menu" id="mainMenu">
        <h2>Hauptmenü</h2>
        <label for="playerName">Spielername:</label>
        <input type="text" id="playerName" placeholder="Name eingeben" />
        <br>
        <button onclick="startGame()">Spiel starten</button>
        <button onclick="showLeaderboard()">Bestenliste anzeigen</button>
    </div>

    <!-- Bestenliste -->
    <div class="menu" id="leaderboard" style="display: none;">
        <h2>Bestenliste</h2>
        <div class="leaderboard" id="leaderboardList">
            <p class="rank gold">1. ---</p>
            <p class="rank silver">2. ---</p>
            <p class="rank bronze">3. ---</p>
        </div>
        <button onclick="backToMenu()">Zurück</button>
    </div>

    <!-- Spielbereich -->
    <div class="game" id="gameArea" style="display: none;">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        <p id="scoreDisplay">Punkte: 0</p>
    </div>

    <!-- Game Over -->
    <div class="menu" id="gameOver" style="display: none;">
        <h2>Spiel vorbei!</h2>
        <p id="finalScore">Dein Punktestand: 0</p>
        <button onclick="backToMenu()">Zurück zum Menü</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const playerNameInput = document.getElementById('playerName');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const finalScoreDisplay = document.getElementById('finalScore');
        const leaderboardList = document.getElementById('leaderboardList');

        let gameState;
        let score;
        let pacMan;
        let ghosts;
        let dots;
        let highScores = [
            { name: "---", score: 0 },
            { name: "---", score: 0 },
            { name: "---", score: 0 }
        ];
        let animationId;

        // Initialisiere Spiel
        function resetGame() {
            gameState = 'playing';
            score = 0;

            pacMan = {
                x: 300,
                y: 300,
                size: 20,
                speed: 2,
                direction: { x: 0, y: 0 },
                poweredUp: false,
                poweredUpTime: 0
            };

            ghosts = [
                { x: 100, y: 100, speed: 1, direction: { x: 1, y: 0 }, canWalkThroughWalls: true },
                { x: 500, y: 500, speed: 1, direction: { x: -1, y: 0 }, canWalkThroughWalls: false }
            ];

            dots = [];
            for (let i = 0; i < 20; i++) {
                for (let j = 0; j < 20; j++) {
                    dots.push({ x: i * 30 + 15, y: j * 30 + 15, eaten: false });
                }
            }
        }

        function startGame() {
            const playerName = playerNameInput.value.trim();
            if (!playerName) {
                alert("Bitte gib deinen Spielernamen ein!");
                return;
            }

            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            resetGame();
            gameLoop();
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            updatePacMan();
            drawPacMan();

            updateGhosts();
            drawGhosts();

            drawDots();
            checkCollisions();

            scoreDisplay.textContent = `Punkte: ${score}`;

            if (gameState === 'playing') {
                animationId = requestAnimationFrame(gameLoop);
            } else {
                endGame();
            }
        }

        function drawDots() {
            dots.forEach(dot => {
                if (!dot.eaten) {
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(dot.x, dot.y, 5, 0, 2 * Math.PI);
                    ctx.fill();
                }
            });
        }

        function endGame() {
            cancelAnimationFrame(animationId);
            const playerName = playerNameInput.value.trim();
            updateHighScores(playerName, score);
            showGameOverScreen();
        }

        function updateHighScores(name, score) {
            highScores.push({ name, score });
            highScores.sort((a, b) => b.score - a.score);
            highScores = highScores.slice(0, 3);
        }

        function showLeaderboard() {
            const leaderboardHtml = highScores.map((entry, index) => {
                const medalClass = index === 0 ? 'gold' : index === 1 ? 'silver' : 'bronze';
                return `<p class="rank ${medalClass}">${index + 1}. ${entry.name}: ${entry.score}</p>`;
            }).join('');
            leaderboardList.innerHTML = leaderboardHtml;

            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'block';
        }

        function backToMenu() {
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp') pacMan.direction = { x: 0, y: -1 };
            if (e.key === 'ArrowDown') pacMan.direction = { x: 0, y: 1 };
            if (e.key === 'ArrowLeft') pacMan.direction = { x: -1, y: 0 };
            if (e.key === 'ArrowRight') pacMan.direction = { x:
