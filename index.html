<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMG Revolver</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: black;
            color: white;
            text-align: center;
            margin: 0;
            padding: 0;
        }
        canvas {
            display: block;
            margin: 20px auto;
            background-color: #222;
            border: 3px solid white;
        }
        .menu, .game-over, .game {
            display: none;
        }
        .menu button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 20px;
            cursor: pointer;
        }
        .leaderboard {
            text-align: center;
            margin: 20px auto;
            width: 300px;
            background: #333;
            border-radius: 10px;
            padding: 10px;
        }
        .leaderboard .rank {
            font-size: 16px;
            margin: 5px 0;
        }
        .gold { color: gold; }
        .silver { color: silver; }
        .bronze { color: #cd7f32; }
    </style>
</head>
<body>
    <h1>DMG Revolver</h1>

    <!-- Main Menu -->
    <div class="menu" id="mainMenu">
        <h2>Hauptmenü</h2>
        <label for="playerName">Spielername:</label>
        <input type="text" id="playerName" placeholder="Name eingeben" />
        <br>
        <button onclick="startGame()">Spiel starten</button>
        <button onclick="showLeaderboard()">Bestenliste</button>
    </div>

    <!-- Leaderboard -->
    <div class="leaderboard" id="leaderboard">
        <h2>Top-Spieler</h2>
        <div id="leaderboardList">
            <p class="rank gold">1. ---</p>
            <p class="rank silver">2. ---</p>
            <p class="rank bronze">3. ---</p>
        </div>
        <button onclick="backToMenu()">Zurück</button>
    </div>

    <!-- Game Canvas -->
    <div class="game" id="gameArea">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        <p id="score">Punkte: 0</p>
    </div>

    <!-- Game Over -->
    <div class="game-over" id="gameOver">
        <h2>Spiel vorbei!</h2>
        <p id="finalScore">Dein Punktestand: 0</p>
        <button onclick="backToMenu()">Zurück zum Menü</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        let gameState, score, pacMan, ghosts, highScores;
        let animationId;

        // Initialisieren der Bestenliste
        highScores = [
            { name: "---", score: 0 },
            { name: "---", score: 0 },
            { name: "---", score: 0 }
        ];

        function resetGame() {
            gameState = 'playing';
            score = 0;
            pacMan = { x: 300, y: 300, size: 20, speed: 2, direction: 'right', poweredUp: false, poweredUpTime: 0 };
            ghosts = [
                { x: 100, y: 100, speed: 1, direction: 'down', canWalkThroughWalls: true },
                { x: 500, y: 500, speed: 1, direction: 'up', canWalkThroughWalls: false }
            ];
        }

        function startGame() {
            const playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert("Bitte gib deinen Spielernamen ein!");
                return;
            }

            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            resetGame();
            updateGame();
        }

        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Pac-Man aktualisieren
            updatePacMan();
            drawPacMan();

            // Geister aktualisieren und zeichnen
            ghosts.forEach(updateGhost);
            ghosts.forEach(drawGhost);

            // Punkte aktualisieren und Kollisionen prüfen
            checkCollisions();

            document.getElementById('score').textContent = `Punkte: ${score}`;

            if (gameState === 'playing') {
                animationId = requestAnimationFrame(updateGame);
            } else {
                endGame();
            }
        }

        function updatePacMan() {
            if (pacMan.direction === 'right') pacMan.x += pacMan.speed;
            if (pacMan.direction === 'left') pacMan.x -= pacMan.speed;
            if (pacMan.direction === 'up') pacMan.y -= pacMan.speed;
            if (pacMan.direction === 'down') pacMan.y += pacMan.speed;

            if (pacMan.x < 0) pacMan.x = canvas.width;
            if (pacMan.x > canvas.width) pacMan.x = 0;
            if (pacMan.y < 0) pacMan.y = canvas.height;
            if (pacMan.y > canvas.height) pacMan.y = 0;
        }

        function drawPacMan() {
            ctx.fillStyle = pacMan.poweredUp ? 'yellow' : 'gold';
            ctx.beginPath();
            ctx.arc(pacMan.x, pacMan.y, pacMan.size, 0.2 * Math.PI, 1.8 * Math.PI);
            ctx.lineTo(pacMan.x, pacMan.y);
            ctx.closePath();
            ctx.fill();
        }

        function updateGhost(ghost) {
            if (ghost.direction === 'right') ghost.x += ghost.speed;
            if (ghost.direction === 'left') ghost.x -= ghost.speed;
            if (ghost.direction === 'up') ghost.y -= ghost.speed;
            if (ghost.direction === 'down') ghost.y += ghost.speed;

            if (!ghost.canWalkThroughWalls) {
                if (ghost.x < 0 || ghost.x > canvas.width || ghost.y < 0 || ghost.y > canvas.height) {
                    ghost.direction = ['up', 'down', 'left', 'right'][Math.floor(Math.random() * 4)];
                }
            }
        }

        function drawGhost(ghost) {
            ctx.fillStyle = 'red';
            ctx.beginPath();
            ctx.arc(ghost.x, ghost.y, 20, 0, 2 * Math.PI);
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.stroke();
        }

        function checkCollisions() {
            ghosts.forEach(ghost => {
                if (Math.hypot(ghost.x - pacMan.x, ghost.y - pacMan.y) < pacMan.size + 20) {
                    gameState = 'game-over';
                }
            });
        }

        function endGame() {
            cancelAnimationFrame(animationId);
            const playerName = document.getElementById('playerName').value.trim();
            updateHighScores(playerName, score);
            showGameOverScreen();
        }

        function updateHighScores(name, score) {
            highScores.push({ name, score });
            highScores.sort((a, b) => b.score - a.score);
            highScores = highScores.slice(0, 3);
        }

        function showGameOverScreen() {
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('gameOver').style.display = 'block';
            document.getElementById('finalScore').textContent = `Dein Punktestand: ${score}`;
        }

        function showLeaderboard() {
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'block';
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = highScores.map((player, index) => {
                const medal = index === 0 ? 'gold' : index === 1 ? 'silver' : 'bronze';
                return `<p class="rank ${medal}">${index + 1}. ${player.name} (${player.score})</p>`;
            }).join('');
        }

        function backToMenu() {
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
        }
    </script>
</body>
</html>
