<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DMG Revolver</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: black;
            color: white;
            margin: 0;
            text-align: center;
        }
        canvas {
            display: block;
            margin: 20px auto;
            background-color: #222;
            border: 2px solid white;
        }
        .menu, .game, .game-over {
            display: none;
        }
        .menu button, .menu input {
            margin: 10px;
            padding: 10px;
            font-size: 18px;
        }
        .leaderboard {
            margin: 20px auto;
            padding: 10px;
            border-radius: 10px;
            background-color: #333;
            color: white;
            width: 300px;
        }
        .rank {
            margin: 5px 0;
            font-size: 16px;
        }
        .gold { color: gold; }
        .silver { color: silver; }
        .bronze { color: #cd7f32; }
    </style>
</head>
<body>
    <h1>DMG Revolver</h1>

    <!-- Hauptmenü -->
    <div class="menu" id="mainMenu">
        <h2>Hauptmenü</h2>
        <label for="playerName">Spielername:</label>
        <input type="text" id="playerName" placeholder="Name eingeben" />
        <br>
        <button onclick="startGame()">Spiel starten</button>
        <button onclick="showLeaderboard()">Bestenliste</button>
    </div>

    <!-- Bestenliste -->
    <div class="menu" id="leaderboard">
        <h2>Top-Spieler</h2>
        <div class="leaderboard" id="leaderboardList">
            <p class="rank gold">1. ---</p>
            <p class="rank silver">2. ---</p>
            <p class="rank bronze">3. ---</p>
        </div>
        <button onclick="backToMenu()">Zurück</button>
    </div>

    <!-- Spiel -->
    <div class="game" id="gameArea">
        <canvas id="gameCanvas" width="600" height="600"></canvas>
        <p id="scoreDisplay">Punkte: 0</p>
    </div>

    <!-- Game Over -->
    <div class="game-over" id="gameOver">
        <h2>Spiel vorbei!</h2>
        <p id="finalScore">Dein Punktestand: 0</p>
        <button onclick="backToMenu()">Zurück zum Menü</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const playerNameInput = document.getElementById('playerName');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const finalScoreDisplay = document.getElementById('finalScore');
        const leaderboardList = document.getElementById('leaderboardList');

        let gameState;
        let score;
        let pacMan;
        let ghosts;
        let dots;
        let highScores = [
            { name: "---", score: 0 },
            { name: "---", score: 0 },
            { name: "---", score: 0 }
        ];
        let animationId;

        function resetGame() {
            gameState = 'playing';
            score = 0;

            pacMan = {
                x: 300,
                y: 300,
                size: 20,
                speed: 2,
                direction: { x: 0, y: 0 },
                poweredUp: false,
                poweredUpTime: 0
            };

            ghosts = [
                { x: 100, y: 100, speed: 1, direction: { x: 1, y: 0 }, canWalkThroughWalls: true },
                { x: 500, y: 500, speed: 1, direction: { x: -1, y: 0 }, canWalkThroughWalls: false }
            ];

            dots = [];
            for (let i = 0; i < 20; i++) {
                for (let j = 0; j < 20; j++) {
                    dots.push({ x: i * 30 + 15, y: j * 30 + 15, eaten: false });
                }
            }
        }

        function startGame() {
            const playerName = playerNameInput.value.trim();
            if (!playerName) {
                alert("Bitte gib deinen Spielernamen ein!");
                return;
            }

            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            resetGame();
            gameLoop();
        }

        function gameLoop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            updatePacMan();
            drawPacMan();

            updateGhosts();
            drawGhosts();

            drawDots();
            checkCollisions();

            scoreDisplay.textContent = `Punkte: ${score}`;

            if (gameState === 'playing') {
                animationId = requestAnimationFrame(gameLoop);
            } else {
                endGame();
            }
        }

        function updatePacMan() {
            pacMan.x += pacMan.direction.x * pacMan.speed;
            pacMan.y += pacMan.direction.y * pacMan.speed;

            if (pacMan.x < 0) pacMan.x = canvas.width;
            if (pacMan.x > canvas.width) pacMan.x = 0;
            if (pacMan.y < 0) pacMan.y = canvas.height;
            if (pacMan.y > canvas.height) pacMan.y = 0;

            if (pacMan.poweredUp && pacMan.poweredUpTime > 0) {
                pacMan.poweredUpTime--;
            } else {
                pacMan.poweredUp = false;
                pacMan.speed = 2;
            }
        }

        function drawPacMan() {
            ctx.fillStyle = pacMan.poweredUp ? 'yellow' : 'gold';
            ctx.beginPath();
            ctx.arc(pacMan.x, pacMan.y, pacMan.size, 0.2 * Math.PI, 1.8 * Math.PI);
            ctx.lineTo(pacMan.x, pacMan.y);
            ctx.closePath();
            ctx.fill();
        }

        function updateGhosts() {
            ghosts.forEach(ghost => {
                ghost.x += ghost.direction.x * ghost.speed;
                ghost.y += ghost.direction.y * ghost.speed;

                if (!ghost.canWalkThroughWalls) {
                    if (ghost.x < 0 || ghost.x > canvas.width || ghost.y < 0 || ghost.y > canvas.height) {
                        ghost.direction.x = -ghost.direction.x;
                        ghost.direction.y = -ghost.direction.y;
                    }
                }
            });
        }

        function drawGhosts() {
            ghosts.forEach(ghost => {
                ctx.fillStyle = 'red';
                ctx.beginPath();
                ctx.arc(ghost.x, ghost.y, 20, 0, 2 * Math.PI);
                ctx.fill();
            });
        }

        function drawDots() {
            dots.forEach(dot => {
                if (!dot.eaten) {
                    ctx.fillStyle = 'white';
                    ctx.beginPath();
                    ctx.arc(dot.x, dot.y, 5, 0, 2 * Math.PI);
                    ctx.fill();
                }
            });
        }

        function checkCollisions() {
            dots.forEach(dot => {
                if (!dot.eaten && Math.hypot(dot.x - pacMan.x, dot.y - pacMan.y) < pacMan.size) {
                    dot.eaten = true;
                    score += 100;
                    if (score % 1000 === 0) {
                        pacMan.poweredUp = true;
                        pacMan.poweredUpTime = 180; // 3 Sekunden
                        pacMan.speed = 4;
                    }
                }
            });

            ghosts.forEach(ghost => {
                if (Math.hypot(ghost.x - pacMan.x, ghost.y - pacMan.y) < pacMan.size + 20) {
                    gameState = 'game-over';
                }
            });
        }

        function endGame() {
            cancelAnimationFrame(animationId);
            const playerName = playerNameInput.value.trim();
            updateHighScores(playerName, score);
            showGameOverScreen();
        }

        function updateHighScores(name, score) {
            highScores.push({ name, score });
            highScores.sort((a, b) => b.score - a.score);
            highScores = highScores.slice(0, 3);
        }

        function showLeaderboard() {
            const leaderboardHtml = highScores.map((entry, index) => {
                const medalClass = index === 0 ? 'gold' : index === 1 ? 'silver' : 'bronze';
                return `<p class="rank ${medalClass}">${index + 1}. ${entry.name}: ${entry.score}</p>`;
            }).join('');
            leaderboardList.innerHTML = leaderboardHtml;

            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'block';
        }

        function showGameOverScreen() {
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('gameOver').style.display = 'block';
            finalScoreDisplay.textContent = `Dein Punktestand: ${score}`;
        }

        function backToMenu() {
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'none';
            document.getElementById('mainMenu').style.display = 'block';
        }

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp') pacMan.direction = { x: 0, y: -1 };
            if (e.key === 'ArrowDown') pacMan.direction = { x: 0, y: 1 };
            if (e.key === 'ArrowLeft') pacMan.direction = { x: -1, y: 0 };
            if (e.key === 'ArrowRight') pacMan.direction = { x: 1, y: 0 };
        });
    </script>
</body>
</html>
